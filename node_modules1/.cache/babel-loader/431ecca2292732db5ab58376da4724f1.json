{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/icon/style\";\nimport _Icon from \"antd/lib/icon\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _classCallCheck from \"D:\\\\company\\\\algo-manage\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\company\\\\algo-manage\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\company\\\\algo-manage\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\company\\\\algo-manage\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\company\\\\algo-manage\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nvar _jsxFileName = \"D:\\\\company\\\\algo-manage\\\\src\\\\algo\\\\modules\\\\main\\\\pages\\\\Login\\\\index.js\";\nimport React from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport backImg from \"@/img/login.jpg\";\nimport md5 from \"js-md5\"; //全局引入\n\nvar FormItem = _Form.Item;\n\nvar FormLogin =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(FormLogin, _React$Component);\n\n  function FormLogin() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, FormLogin);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(FormLogin)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      refreshLoading: false\n    };\n\n    _this.handleSubmit = function () {\n      _this.props.form.validateFields(function (err) {\n        if (!err) {\n          var params = _this.props.form.getFieldsValue();\n\n          var ps = params.password;\n          params.password = md5(params.password); // params.oper = \"Q\";\n          // console.log(params);\n\n          http.post({\n            url: \"/tell-info/login\",\n            data: params\n          }).then(function (res) {\n            // console.log(res);\n            // if (res.code == 0) {\n            //     sessionStorage.isLogin = true;\n            //     sessionStorage.userName = params.userName;\n            //     // 0  有   导入导出权限\n            //     // 1  没有 导入导出权限\n            //     sessionStorage.userPrivilege = res.data.userPrivilege;\n            //     // sessionStorage.userPrivilege = 1;\n            //     // sessionStorage.userArr = JSON.stringify(res.data);\n            //     // this.props.history.push(\"/main/updown/userInfo\");\n            //     this.props.history.push(\"/main/user/userInfo\");\n            // } else {\n            //     message.error(res.message || \"用户名或密码错误\");\n            // }\n            if (res.code == 200) {\n              sessionStorage.isLogin = true;\n              sessionStorage.userName = params.user_id;\n              sessionStorage.ps = ps; // user_type 用户类型， 1-超级管理员，2-普通用户 6 总线超级管理员\n              // 1  没有 导入导出权限\n\n              if (res.allow == 1) {\n                // this.props.history.push(\"/main/user/userInfo\");\n                localStorage.user_type = res.user_type;\n\n                _this.getUserAuth();\n              } else {\n                _message.error(\"用户名或密码错误\");\n              }\n            } else {\n              _message.error(res.message || \"用户名或密码错误\");\n            }\n          });\n        }\n      });\n    };\n\n    _this.getUserAuth = function () {\n      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      params = {\n        user_id: sessionStorage.userName,\n        user_type: localStorage.user_type / 1\n      };\n      http.post({\n        url: \"/tell-info/userAuth\",\n        data: params\n      }).then(function (res) {\n        // console.log(res);\n        //解析数据字典\n        if (res.code == 200) {\n          sessionStorage.auth = res.auth; // console.log(JSON.stringify(JSON.parse(res.auth)));\n\n          _this.hasUserInfo = false;\n\n          _this.changeMenus(JSON.parse(res.auth)); // this.props.history.push(\"/main/user/userInfo\");\n\n\n          if (window.menus.length == 0) {\n            _message.info(\"用户菜单权限为空\");\n          } else {\n            if (_this.hasUserInfo) {\n              _this.props.history.push(\"/main/user/userInfo\");\n            } else {\n              var url = \"\";\n\n              if (window.menus[0].hasOwnProperty(\"children\") && window.menus[0].children && window.menus[0].children.length > 0) {\n                url = window.menus[0].children[0].path;\n                console.log(url);\n\n                _this.props.history.push(url);\n              } else {\n                _message.info(\"用户菜单权限为空\");\n              }\n            }\n          }\n        } else {\n          _message.info(\"获取用户权限失败\");\n        }\n      });\n    };\n\n    _this.changeMenus = function () {\n      // console.log(\"changeMenus-------\");\n      var auth = sessionStorage.auth; // sessionStorage.menusBackup = undefined;\n\n      if (sessionStorage.menusBackup != undefined) {\n        window.menus = JSON.parse(sessionStorage.menusBackup); // console.log(window.menus);\n      }\n\n      if (!auth) {\n        console.log(\"没有权限菜单，显示本地菜单\");\n        return;\n      } // let newAuth = auth.replace(/name/g, \"title\");\n\n\n      var authMenu = JSON.parse(auth); // console.log(JSON.stringify(window.menus));\n      // console.log(window.menus);\n      // console.log(\"authMenu\", authMenu);\n      // authMenu[0].auth = 0;\n      // window.menus = menu;\n\n      for (var i = 0; i < window.menus.length; i++) {\n        var localItem = window.menus[i]; // console.log(\"本地 \", localItem);\n\n        for (var j = 0; j < authMenu.length; j++) {\n          var authItem = authMenu[j]; // console.log(\"权限 \", authItem);\n\n          if (localItem.title == authItem.name) {\n            localItem.auth = authItem.auth; //删除 不显示的菜单\n            // console.log(localItem, i, j);\n\n            if (authItem.auth != 1) {\n              // console.log(\"不显示一级 \", localItem);\n              window.menus.splice(i, 1);\n              i--;\n              break;\n            }\n\n            if (localItem.hasOwnProperty(\"children\") && authItem.hasOwnProperty(\"children\")) {\n              var localChild = localItem.children;\n              var authChild = authItem.children;\n\n              for (var k = 0; k < localChild.length; k++) {\n                var localChildItem = localChild[k]; // console.log(\"local:--- \", k, localChildItem);\n\n                for (var l = 0; l < authChild.length; l++) {\n                  // console.log(\"authChild: \",authChild[l]);\n                  if (localChildItem.title == authChild[l].name) {\n                    localChildItem.auth = authChild[l].auth;\n                    localChildItem.cmpt = authChild[l].cmpt;\n\n                    if (authChild[l].name == \"用户管理\" && authChild[l].auth == 1) {\n                      _this.hasUserInfo = true;\n                    }\n\n                    if (authChild[l].auth != 1) {\n                      // console.log(\n                      //     \"不显示二级菜单 aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\n                      //     localChildItem\n                      // );\n                      localChild.splice(k, 1);\n                      k--;\n                      break;\n                    }\n                  }\n                }\n              }\n            }\n\n            break;\n          } else if (j == authMenu.length - 1) {\n            // console.log(\"没有菜单\", localItem, i);\n            window.menus.splice(i, 1);\n            i--;\n          }\n        }\n      } // console.log(window.menus);\n\n\n      sessionStorage.activeMenus = JSON.stringify(window.menus); // console.log(JSON.stringify(window.menus));\n    };\n\n    _this.handleSet = function () {\n      console.log(\"设置\");\n    };\n\n    return _this;\n  }\n\n  _createClass(FormLogin, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {}\n  }, {\n    key: \"render\",\n    value: function render() {\n      var getFieldDecorator = this.props.form.getFieldDecorator;\n\n      _message.config({\n        duration: 2.0,\n        top: 360,\n        maxCount: 1\n      });\n\n      return React.createElement(\"div\", {\n        style: {\n          display: \"flex\",\n          alignItems: \"center\",\n          height: \"100%\",\n          width: \"100%\",\n          // background: \"#f0f2f5\"\n          background: \"url(\".concat(backImg, \") no-repeat center\"),\n          backgroundSize: \"cover\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, React.createElement(_Form, {\n        style: {\n          width: 320,\n          margin: \"0 auto\",\n          padding: \"25px\",\n          background: \"white\",\n          opacity: 1\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          marginBottom: \"20px\",\n          paddingLeft: \"33px\",\n          fontSize: \"18px\",\n          fontWeight: \"bold\",\n          background: \"left no-repeat url(./assets/logo.png)\",\n          backgroundSize: \"25px\" // backgroundColor: \"rgba(48,128,232,0.3)\"\n\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      }, \"\\u7B97\\u6CD5\\u9879\\u76EE\\u7BA1\\u7406\\u7CFB\\u7EDF\"), React.createElement(FormItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      }, getFieldDecorator(\"user_id\", {\n        // initialValue: \"algoAdmin\",\n        initialValue: sessionStorage.userName ? sessionStorage.userName : \"\",\n        // initialValue: \"11\",\n        // initialValue: \"user_read_only\",\n        rules: [{\n          required: true,\n          message: \"用户名不能为空\"\n        }, {\n          max: 15,\n          message: \"长度不在范围内\"\n        }, {\n          pattern: new RegExp(\"^\\\\w+$\", \"g\"),\n          message: \"用户名必须为字母或者数字\"\n        }]\n      })(React.createElement(_Input, {\n        prefix: React.createElement(_Icon, {\n          type: \"user\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 252\n          },\n          __self: this\n        }),\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }))), React.createElement(FormItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257\n        },\n        __self: this\n      }, getFieldDecorator(\"password\", {\n        initialValue: sessionStorage.ps ? sessionStorage.ps : \"\",\n        rules: []\n      })(React.createElement(_Input, {\n        prefix: React.createElement(_Icon, {\n          type: \"lock\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 265\n          },\n          __self: this\n        }),\n        type: \"password\",\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264\n        },\n        __self: this\n      }))), React.createElement(FormItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }, React.createElement(_Button, {\n        style: {\n          width: \"100%\"\n        },\n        type: \"primary\",\n        onClick: this.handleSubmit,\n        loading: this.state.refreshLoading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      }, \"\\u767B\\u5F55\"))));\n    }\n  }]);\n\n  return FormLogin;\n}(React.Component);\n\nexport default withRouter(_Form.create()(FormLogin));","map":{"version":3,"sources":["D:/company/algo-manage/src/algo/modules/main/pages/Login/index.js"],"names":["React","withRouter","backImg","md5","FormItem","Item","FormLogin","state","refreshLoading","handleSubmit","props","form","validateFields","err","params","getFieldsValue","ps","password","http","post","url","data","then","res","code","sessionStorage","isLogin","userName","user_id","allow","localStorage","user_type","getUserAuth","error","message","auth","hasUserInfo","changeMenus","JSON","parse","window","menus","length","info","history","push","hasOwnProperty","children","path","console","log","menusBackup","undefined","authMenu","i","localItem","j","authItem","title","name","splice","localChild","authChild","k","localChildItem","l","cmpt","activeMenus","stringify","handleSet","getFieldDecorator","config","duration","top","maxCount","display","alignItems","height","width","background","backgroundSize","margin","padding","opacity","marginBottom","paddingLeft","fontSize","fontWeight","initialValue","rules","required","max","pattern","RegExp","Component","create"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { Form, Input, Button, message, Icon, Checkbox } from \"antd\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport backImg from \"@/img/login.jpg\";\r\nimport md5 from \"js-md5\"; //全局引入\r\n\r\nconst FormItem = Form.Item;\r\nclass FormLogin extends React.Component {\r\n    state = {\r\n        refreshLoading: false,\r\n    };\r\n\r\n    handleSubmit = () => {\r\n        this.props.form.validateFields((err) => {\r\n            if (!err) {\r\n                let params = this.props.form.getFieldsValue();\r\n                let ps = params.password;\r\n                params.password = md5(params.password);\r\n                // params.oper = \"Q\";\r\n                // console.log(params);\r\n                http.post({\r\n                    url: \"/tell-info/login\",\r\n                    data: params,\r\n                }).then((res) => {\r\n                    // console.log(res);\r\n                    // if (res.code == 0) {\r\n                    //     sessionStorage.isLogin = true;\r\n                    //     sessionStorage.userName = params.userName;\r\n                    //     // 0  有   导入导出权限\r\n                    //     // 1  没有 导入导出权限\r\n                    //     sessionStorage.userPrivilege = res.data.userPrivilege;\r\n                    //     // sessionStorage.userPrivilege = 1;\r\n                    //     // sessionStorage.userArr = JSON.stringify(res.data);\r\n                    //     // this.props.history.push(\"/main/updown/userInfo\");\r\n                    //     this.props.history.push(\"/main/user/userInfo\");\r\n                    // } else {\r\n                    //     message.error(res.message || \"用户名或密码错误\");\r\n                    // }\r\n                    if (res.code == 200) {\r\n                        sessionStorage.isLogin = true;\r\n                        sessionStorage.userName = params.user_id;\r\n                        sessionStorage.ps = ps;\r\n                        // user_type 用户类型， 1-超级管理员，2-普通用户 6 总线超级管理员\r\n                        // 1  没有 导入导出权限\r\n                        if (res.allow == 1) {\r\n                            // this.props.history.push(\"/main/user/userInfo\");\r\n                            localStorage.user_type = res.user_type;\r\n                            this.getUserAuth();\r\n                        } else {\r\n                            message.error(\"用户名或密码错误\");\r\n                        }\r\n                    } else {\r\n                        message.error(res.message || \"用户名或密码错误\");\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    };\r\n    getUserAuth = (params = {}) => {\r\n        params = {\r\n            user_id: sessionStorage.userName,\r\n            user_type: localStorage.user_type / 1,\r\n        };\r\n        http.post({\r\n            url: \"/tell-info/userAuth\",\r\n            data: params,\r\n        }).then((res) => {\r\n            // console.log(res);\r\n            //解析数据字典\r\n            if (res.code == 200) {\r\n                sessionStorage.auth = res.auth;\r\n                // console.log(JSON.stringify(JSON.parse(res.auth)));\r\n                this.hasUserInfo = false;\r\n                this.changeMenus(JSON.parse(res.auth));\r\n                // this.props.history.push(\"/main/user/userInfo\");\r\n                if (window.menus.length == 0) {\r\n                    message.info(\"用户菜单权限为空\");\r\n                } else {\r\n                    if (this.hasUserInfo) {\r\n                        this.props.history.push(\"/main/user/userInfo\");\r\n                    } else {\r\n                        let url = \"\";\r\n                        if (\r\n                            window.menus[0].hasOwnProperty(\"children\") &&\r\n                            window.menus[0].children &&\r\n                            window.menus[0].children.length > 0\r\n                        ) {\r\n                            url = window.menus[0].children[0].path;\r\n                            console.log(url);\r\n                            this.props.history.push(url);\r\n                        } else {\r\n                            message.info(\"用户菜单权限为空\");\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                message.info(\"获取用户权限失败\");\r\n            }\r\n        });\r\n    };\r\n    changeMenus = () => {\r\n        // console.log(\"changeMenus-------\");\r\n        let auth = sessionStorage.auth;\r\n        // sessionStorage.menusBackup = undefined;\r\n        if (sessionStorage.menusBackup != undefined) {\r\n            window.menus = JSON.parse(sessionStorage.menusBackup);\r\n            // console.log(window.menus);\r\n        }\r\n        if (!auth) {\r\n            console.log(\"没有权限菜单，显示本地菜单\");\r\n            return;\r\n        }\r\n        // let newAuth = auth.replace(/name/g, \"title\");\r\n        let authMenu = JSON.parse(auth);\r\n        // console.log(JSON.stringify(window.menus));\r\n        // console.log(window.menus);\r\n        // console.log(\"authMenu\", authMenu);\r\n        // authMenu[0].auth = 0;\r\n        // window.menus = menu;\r\n        for (let i = 0; i < window.menus.length; i++) {\r\n            let localItem = window.menus[i];\r\n            // console.log(\"本地 \", localItem);\r\n            for (let j = 0; j < authMenu.length; j++) {\r\n                let authItem = authMenu[j];\r\n                // console.log(\"权限 \", authItem);\r\n                if (localItem.title == authItem.name) {\r\n                    localItem.auth = authItem.auth;\r\n                    //删除 不显示的菜单\r\n                    // console.log(localItem, i, j);\r\n                    if (authItem.auth != 1) {\r\n                        // console.log(\"不显示一级 \", localItem);\r\n                        window.menus.splice(i, 1);\r\n                        i--;\r\n                        break;\r\n                    }\r\n                    if (\r\n                        localItem.hasOwnProperty(\"children\") &&\r\n                        authItem.hasOwnProperty(\"children\")\r\n                    ) {\r\n                        let localChild = localItem.children;\r\n                        let authChild = authItem.children;\r\n                        for (let k = 0; k < localChild.length; k++) {\r\n                            let localChildItem = localChild[k];\r\n                            // console.log(\"local:--- \", k, localChildItem);\r\n                            for (let l = 0; l < authChild.length; l++) {\r\n                                // console.log(\"authChild: \",authChild[l]);\r\n                                if (localChildItem.title == authChild[l].name) {\r\n                                    localChildItem.auth = authChild[l].auth;\r\n                                    localChildItem.cmpt = authChild[l].cmpt;\r\n                                    if (\r\n                                        authChild[l].name == \"用户管理\" &&\r\n                                        authChild[l].auth == 1\r\n                                    ) {\r\n                                        this.hasUserInfo = true;\r\n                                    }\r\n                                    if (authChild[l].auth != 1) {\r\n                                        // console.log(\r\n                                        //     \"不显示二级菜单 aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\r\n                                        //     localChildItem\r\n                                        // );\r\n                                        localChild.splice(k, 1);\r\n                                        k--;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    break;\r\n                } else if (j == authMenu.length - 1) {\r\n                    // console.log(\"没有菜单\", localItem, i);\r\n                    window.menus.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n        }\r\n        // console.log(window.menus);\r\n        sessionStorage.activeMenus = JSON.stringify(window.menus);\r\n        // console.log(JSON.stringify(window.menus));\r\n    };\r\n    handleSet = () => {\r\n        console.log(\"设置\");\r\n    };\r\n\r\n    componentDidMount() {}\r\n    render() {\r\n        const { getFieldDecorator } = this.props.form;\r\n        message.config({\r\n            duration: 2.0,\r\n            top: 360,\r\n            maxCount: 1,\r\n        });\r\n        return (\r\n            <div\r\n                style={{\r\n                    display: \"flex\",\r\n                    alignItems: \"center\",\r\n                    height: \"100%\",\r\n                    width: \"100%\",\r\n                    // background: \"#f0f2f5\"\r\n                    background: `url(${backImg}) no-repeat center`,\r\n                    backgroundSize: \"cover\",\r\n                }}\r\n            >\r\n                <Form\r\n                    style={{\r\n                        width: 320,\r\n                        margin: \"0 auto\",\r\n                        padding: \"25px\",\r\n                        background: \"white\",\r\n                        opacity: 1,\r\n                    }}\r\n                >\r\n                    <div\r\n                        style={{\r\n                            marginBottom: \"20px\",\r\n                            paddingLeft: \"33px\",\r\n                            fontSize: \"18px\",\r\n                            fontWeight: \"bold\",\r\n                            background: \"left no-repeat url(./assets/logo.png)\",\r\n                            backgroundSize: \"25px\",\r\n                            // backgroundColor: \"rgba(48,128,232,0.3)\"\r\n                        }}\r\n                    >\r\n                        算法项目管理系统\r\n                    </div>\r\n                    <FormItem>\r\n                        {/* {getFieldDecorator(\"userName\", { */}\r\n                        {getFieldDecorator(\"user_id\", {\r\n                            // initialValue: \"algoAdmin\",\r\n                            initialValue: sessionStorage.userName\r\n                                ? sessionStorage.userName\r\n                                : \"\",\r\n                            // initialValue: \"11\",\r\n                            // initialValue: \"user_read_only\",\r\n                            rules: [\r\n                                {\r\n                                    required: true,\r\n                                    message: \"用户名不能为空\",\r\n                                },\r\n                                {\r\n                                    max: 15,\r\n                                    message: \"长度不在范围内\",\r\n                                },\r\n                                {\r\n                                    pattern: new RegExp(\"^\\\\w+$\", \"g\"),\r\n                                    message: \"用户名必须为字母或者数字\",\r\n                                },\r\n                            ],\r\n                        })(\r\n                            <Input\r\n                                prefix={<Icon type=\"user\" />}\r\n                                placeholder=\"请输入用户名\"\r\n                            />\r\n                        )}\r\n                    </FormItem>\r\n                    <FormItem>\r\n                        {getFieldDecorator(\"password\", {\r\n                            initialValue: sessionStorage.ps\r\n                                ? sessionStorage.ps\r\n                                : \"\",\r\n                            rules: [],\r\n                        })(\r\n                            <Input\r\n                                prefix={<Icon type=\"lock\" />}\r\n                                type=\"password\"\r\n                                placeholder=\"请输入密码\"\r\n                            />\r\n                        )}\r\n                    </FormItem>\r\n                    <FormItem>\r\n                        <Button\r\n                            style={{ width: \"100%\" }}\r\n                            type=\"primary\"\r\n                            onClick={this.handleSubmit}\r\n                            loading={this.state.refreshLoading}\r\n                        >\r\n                            登录\r\n                        </Button>\r\n                    </FormItem>\r\n                </Form>\r\n            </div>\r\n        );\r\n    }\r\n}\r\nexport default withRouter(Form.create()(FormLogin));\r\n"]},"metadata":{},"sourceType":"module"}